<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GRAPES: chunkidset_test.c</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GRAPES
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">chunkidset_test.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>A test program showing how to use the Chunk ID Set API.</p>
<div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment"> *  Copyright (c) 2009 Luca Abeni</span>
<span class="comment"> *</span>
<span class="comment"> *  This is free software; see gpl-3.0.txt</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;stdint.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="chunkidset_8h.html" title="Structure containing a set of chunk IDs.">chunkidset.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="trade__sig__la_8h.html" title="Chunk Signaling API - Lower Abstraction.">trade_sig_la.h</a>&quot;</span>
<span class="preprocessor">#include &quot;chunkid_set_h.h&quot;</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> simple_test(<span class="keywordtype">void</span>)
{
  <span class="keyword">struct </span>chunkID_set *cset;
  <span class="keywordtype">char</span> config[32];

  sprintf(config,<span class="stringliteral">&quot;size=%d&quot;</span>,10);
  cset = <a name="a0"></a><a class="code" href="chunkidset_8h.html#a1d3132a8b8e20497bc7d984019bd3bce" title="Allocate a chunk ID set.">chunkID_set_init</a>(config);
  <span class="keywordflow">if</span>(!cset){
    fprintf(stderr,<span class="stringliteral">&quot;Unable to allocate memory for rcset\n&quot;</span>);

    <span class="keywordflow">return</span>;
  }

  printf(<span class="stringliteral">&quot;Chunk ID Set initialised: size is %d\n&quot;</span>, <a name="a1"></a><a class="code" href="chunkidset_8h.html#a22b6681505e59ab6e14030001cbf4110" title="Get the set size.">chunkID_set_size</a>(cset));
  fillChunkID_set(cset, 0);
  printChunkID_set(cset);
  check_chunk(cset, 4);
  check_chunk(cset, 2);
  check_chunk(cset, 3);
  check_chunk(cset, 9);
  printf(<span class="stringliteral">&quot;Earliest chunk %d\nLatest chunk %d.\n&quot;</span>,
          <a name="a2"></a><a class="code" href="chunkidset_8h.html#ad4b905da022593e4ff35d00be4505f0a" title="Get the smallest chunk ID from a set.">chunkID_set_get_earliest</a>(cset), <a name="a3"></a><a class="code" href="chunkidset_8h.html#a06d93179649b1a85ed67812dbea626de" title="Get the largest chunk ID from a set.">chunkID_set_get_latest</a>(cset));
  <a name="a4"></a><a class="code" href="chunkidset_8h.html#ad8ceafa377d0c878d125c0f3c34884f0">chunkID_set_clear</a>(cset, 0);
  free(cset);
}

<span class="keyword">static</span> <span class="keywordtype">void</span> encoding_test(<span class="keyword">const</span> <span class="keywordtype">char</span> *mode)
{
  <span class="keyword">struct </span>chunkID_set *cset, *cset1;
  <span class="keyword">static</span> uint8_t buff[2048];
  <span class="keywordtype">int</span> res, meta_len;
  <span class="keywordtype">void</span> *meta;
  <span class="keywordtype">char</span> config[32];

  sprintf(config, <span class="stringliteral">&quot;type=%s&quot;</span>, mode);
  cset = <a class="code" href="chunkidset_8h.html#a1d3132a8b8e20497bc7d984019bd3bce" title="Allocate a chunk ID set.">chunkID_set_init</a>(config);
  <span class="keywordflow">if</span>(!cset){
    fprintf(stderr,<span class="stringliteral">&quot;Unable to allocate memory for rcset\n&quot;</span>);

    <span class="keywordflow">return</span>;
  }

  fillChunkID_set(cset, 0);
  res = <a name="a5"></a><a class="code" href="trade__sig__la_8h.html#ab67f973071dbf755e59b08f467dfd3a1" title="Decode the bit streamEncode a sequence of information, filling the buffer with the corresponding bit ...">encodeChunkSignaling</a>(cset, NULL, 0, buff, <span class="keyword">sizeof</span>(buff));
  printf(<span class="stringliteral">&quot;Encoding Result: %d\n&quot;</span>, res);
  <a class="code" href="chunkidset_8h.html#ad8ceafa377d0c878d125c0f3c34884f0">chunkID_set_clear</a>(cset, 0);
  free(cset);
  
  cset1 = <a name="a6"></a><a class="code" href="trade__sig__la_8h.html#a1ecd5ef5b7e7add9e319f9a6f4422496" title="Decode the bit stream.">decodeChunkSignaling</a>(&amp;meta, &amp;meta_len, buff, res);
  printChunkID_set(cset1);
  <a class="code" href="chunkidset_8h.html#ad8ceafa377d0c878d125c0f3c34884f0">chunkID_set_clear</a>(cset1, 0);
  free(cset1);
}

<span class="keyword">static</span> <span class="keywordtype">void</span> metadata_test(<span class="keywordtype">void</span>)
{
  <span class="keyword">struct </span>chunkID_set *cset;
  <span class="keyword">static</span> uint8_t buff[2048];
  <span class="keywordtype">int</span> res, meta_len;
  <span class="keywordtype">void</span> *meta;

  meta = strdup(<span class="stringliteral">&quot;This is a test&quot;</span>);
  res = <a class="code" href="trade__sig__la_8h.html#ab67f973071dbf755e59b08f467dfd3a1" title="Decode the bit streamEncode a sequence of information, filling the buffer with the corresponding bit ...">encodeChunkSignaling</a>(NULL, meta, strlen(meta) + 1, buff, <span class="keyword">sizeof</span>(buff));
  printf(<span class="stringliteral">&quot;Encoding Result: %d\n&quot;</span>, res);
  free(meta);
  
  cset = <a class="code" href="trade__sig__la_8h.html#a1ecd5ef5b7e7add9e319f9a6f4422496" title="Decode the bit stream.">decodeChunkSignaling</a>(&amp;meta, &amp;meta_len, buff, res);
  printf(<span class="stringliteral">&quot;Decoded MetaData: %s (%d)\n&quot;</span>, (<span class="keywordtype">char</span> *)meta, meta_len);

  <span class="keywordflow">if</span> (cset) {
    <a class="code" href="chunkidset_8h.html#ad8ceafa377d0c878d125c0f3c34884f0">chunkID_set_clear</a>(cset, 0);
    free(cset);
  }

  free(meta);
}

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
  simple_test();
  encoding_test(<span class="stringliteral">&quot;priority&quot;</span>);
  encoding_test(<span class="stringliteral">&quot;bitmap&quot;</span>);
  metadata_test();

  <span class="keywordflow">return</span> 0;
}
</pre></div> </div><!-- contents -->
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri May 3 2013 10:18:23 for GRAPES by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
